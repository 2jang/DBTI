<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBTI 테스트</title>
    <style>
        body {
            background-color: #feeab5;
        }

        article {
            display: flex;
            flex-direction: column;
        }

        .question,.result {
            display: none;
        }
        button {
            border: 4px solid gray;
            margin: 0 auto;
        }
    </style>
</head>

<body>
<div class="container">
    <!-- 강아지 성격 유형 테스크 시작 화면 -->
    <article class="start">
        <h1>강아지 성격 유형 테스트(DBTI)</h1>
        <h2>12문제로 알아보는 내 강아지의 성격 유형은? 테스트로 알아보자!</h2>
        <button type="button" onclick="start();">테스트 시작하기</button> <!-- 시작하기 버튼 누르면 start 가려지고 question 보임 -->
    </article>

    <!-- 강아지 성격 유형 테스트 화면, 버튼 2개로 답변 함-->
    <article class="question">
        <h2 id="title">문제</h2>
        <input id="type" type="hidden" value="EI">
        <button id="A" type="button">대답1</button>
        <button id="B" type="button">대답2</button>
    </article>

    <!-- 결과 창, 결과 강아지와 설명을 출력 -->

</div>

<input type="hidden" id="EI" value="0">
<input type="hidden" id="SN" value="0">
<input type="hidden" id="TF" value="0">
<input type="hidden" id="JP" value="0">

<script>
    // 사람 MBTI 처럼 테스트를 한 후 최종적으로 DBTI로 리턴해줌

    var num = 1;

    var q = {
        1: {
            "title": "산책을 나가려고 하는데, 우리 강아지는?",
            "type": "EI",
            "A": "사람과 강아지가 많은 번화한 공원으로 가고 싶어한다",
            "B": "조용하고 한적한 곳으로 가고 싶어한다"
        },
        2: {
            "title": "산책 중 낯선 강아지를 만났을 때, 우리 강아지는?",
            "type": "EI",
            "A": "꼬리를 흔들며 반갑게 다가간다",
            "B": "조심스럽게 냄새를 맡으며 경계한다"
        },
        3: {
            "title": "공원에서 다른 강아지들이 놀고 있을 때, 우리 강아지는?",
            "type": "EI",
            "A": "신나게 달려가 함께 어울린다",
            "B": "멀리서 구경만 하며 혼자 노는 걸 좋아한다"
        },
        4: {
            "title": "산책로에 갈림길이 나왔을 때, 우리 강아지는?",
            "type": "SN",
            "A": "늘 가던 익숙한 길로 가려고 한다",
            "B": "새로운 냄새가 나는 길로 호기심을 보인다"
        },
        5: {
            "title": "다른 강아지가 길을 헤매고 있을 때, 우리 강아지는?",
            "type": "SN",
            "A": "상세하게 냄새로 길을 안내하려 노력한다",
            "B": "대충 큰 길쪽으로 가라고 짖는다"
        },
        6: {"title": "산책이 끝났을 때, 우리 강아지에게 중요해 보이는 건?", "type": "SN", "A": "집에 돌아왔다는 사실", "B": "산책하는 동안 경험한 것들"},
        7: {
            "title": "다른 강아지가 우울해 보일 때, 우리 강아지는?",
            "type": "TF",
            "A": "상황을 파악하려고 냄새를 맡는다",
            "B": "다가가서 부비며 위로하려 한다"
        },
        8: {
            "title": "다음 산책 약속을 잡을 때, 우리 강아지는?",
            "type": "TF",
            "A": "특정 시간에 맞춰 준비하고 기다린다",
            "B": "아무 때나 산책 나갈 수 있게 들떠있다"
        },
        9: {
            "title": "집에 돌아왔을 때 장난감이 어질러져 있으면, 우리 강아지는?",
            "type": "TF",
            "A": "장난감을 물어 제자리에 가져다 놓으려 한다",
            "B": "신경 쓰지 않고 그대로 둔다"
        },
        10: {"title": "밤이 되어 잠들기 전, 우리 강아지는?", "type": "JP", "A": "다음날 산책 갈 곳을 정하려는 듯 안절부절 못한다", "B": "별 생각 없이 편하게 잠든다"},
        11: {
            "title": "아침이 밝았을 때, 우리 강아지는?",
            "type": "JP",
            "A": "늘 일어나던 시간에 맞춰 일어난다",
            "B": "내가 깨울 때까지 계속 잔다"
        },
        12: {
            "title": "아침에 일어난 후, 우리 강아지가 가장 먼저 하는 행동은?",
            "type": "JP",
            "A": "항상 하던 대로 밥부터 먹고 화장실에 간다",
            "B": "기분 내키는 대로 이것저것 한다"
        }
    }

    window.onload = function() {
        let num = 1;
        const startButton = document.querySelector('.start button');
        const questionSection = document.querySelector('.question');
        const resultSection = document.querySelector('.result');
        const buttonA = document.getElementById('A');
        const buttonB = document.getElementById('B');

        if (startButton) {
            startButton.addEventListener('click', start);
        }

        if (buttonA) {
            buttonA.addEventListener('click', function() {
                const type = document.getElementById('type').value;
                const preValue = document.getElementById(type).value;
                document.getElementById(type).value = parseInt(preValue) + 1;
                next();
            });
        }

        if (buttonB) {
            buttonB.addEventListener('click', next);
        }

        function start() {
            document.querySelector('.start').style.display = 'none';
            if (questionSection) {
                questionSection.style.display = 'block';
            }
            next();
        }

        function next() {
            if (num == 13) {
                if (questionSection) {
                    questionSection.style.display = 'none';
                }
                if (resultSection) {
                    resultSection.style.display = 'block';
                }

                // MBTI 결과 계산
                let mbti = '';
                mbti += document.getElementById('EI').value < 2 ? 'I' : 'E';
                mbti += document.getElementById('SN').value < 2 ? 'N' : 'S';
                mbti += document.getElementById('TF').value < 2 ? 'F' : 'T';
                mbti += document.getElementById('JP').value < 2 ? 'P' : 'J';
                console.log(mbti);

                // MBTI 결과를 서버로 전송
                fetch('http://localhost:5000/submit_mbti', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({mbti: mbti}),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });

            } else {
                const titleElement = document.getElementById('title');
                const typeElement = document.getElementById('type');

                if (titleElement && q[num] && q[num].title) {
                    titleElement.textContent = q[num].title;
                }
                if (typeElement && q[num] && q[num].type) {
                    typeElement.value = q[num].type;
                }
                if (buttonA && q[num] && q[num].A) {
                    buttonA.textContent = q[num].A;
                }
                if (buttonB && q[num] && q[num].B) {
                    buttonB.textContent = q[num].B;
                }
                num++;
            }
        }
    }
</script>
</body>
</html>